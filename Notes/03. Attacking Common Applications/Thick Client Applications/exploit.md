# Attacking Thick Client Applications

## 1. Thick Client Application Overview

* Locally installed applications that execute most logic on the client side.
* Common technologies: .NET, Java, C++.
* Common risks:
  * Hardcoded credentials
  * DLL hijacking
  * Insecure storage
  * Improper error handling
  * Unencrypted communication
* Architectures:
  * **Two-tier** (client ↔ database)
  * **Three-tier** (client ↔ app server ↔ database)

---

## 2. Penetration Testing Steps

### 2.1 Information Gathering

Identify:
* Architecture layout
* Technologies used
* Local storage/registry usage
* External dependencies

Useful tools:
* CFF Explorer
* Detect It Easy
* Process Monitor
* Strings
* PE Explorer

---

### 2.2 Client-Side Attacks

Analyze local logic and binaries for:
* Secrets
* API keys
* Hardcoded credentials
* Weak validation

Tools:
* Ghidra
* IDA
* OllyDbg
* Radare2
* dnSpy
* x64dbg
* JADX
* Frida
* De4Dot (for .NET deobfuscation)

---

### 2.3 Network-Side Attacks

Intercept and inspect traffic for:
* Credentials
* Sensitive tokens
* Unencrypted data

Tools:
* Wireshark
* tcpdump
* TCPView
* Burp Suite
* mitmproxy

---

### 2.4 Server-Side Attacks

* Test server endpoints as you would a typical web application.
* Look for:
  * Authentication flaws
  * IDORs
  * SQLi
  * Path traversal
* Check for DLL hijacking in client-side loaders.

---

## 3. Retrieving Hardcoded Credentials

### Scenario Summary

* SMB share exposed.
* Found: `RestartOracle-Service.exe` in NETLOGON.
* Executing the file caused temporary files to appear.

### Investigation Steps

1. **Monitor Execution**
   * Use ProcMon to trace dropped/modified files.
   * Temporarily lock Temp directories to prevent auto-deletion.

2. **Inspect Dropped Files**
   * A batch script created:
     * A `.txt` file
     * A PowerShell script (`monta.ps1`)
     * `restart-service.exe`
   * PowerShell script decodes data from the `.txt` file.

3. **Reverse Engineering**
   * Debug `restart-service.exe` via x64dbg.
   * Dump memory region containing executable content.
   * Analyze dump for plaintext credentials using `strings`.
   * Clean .NET obfuscation using De4Dot.
   * Use dnSpy to explore code and locate credentials.

### Commands

```bash
# Run thick client executable
C:\Apps> .\Restart-OracleService.exe

# View temporary files
C:\Apps> dir C:\Users\cybervaca\AppData\Local\Temp\2

# Inspect PowerShell script
C:\> type C:\programdata\monta.ps1

# List ProgramData contents
C:\> dir C:\programdata\

# Extract strings from memory dump
strings64.exe restart-service_00000000001E0000.bin

# Deobfuscate .NET file
de4dot restart-service_00000000001E0000.bin

# Extract strings from PowerShell script
strings C:\programdata\monta.ps1

# View application logs
Get-EventLog -LogName Application -Newest 50
```
